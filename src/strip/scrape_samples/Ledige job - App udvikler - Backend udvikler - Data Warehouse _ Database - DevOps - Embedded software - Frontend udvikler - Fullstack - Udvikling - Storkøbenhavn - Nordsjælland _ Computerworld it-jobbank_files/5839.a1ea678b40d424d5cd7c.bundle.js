(self.webpackChunkjix=self.webpackChunkjix||[]).push([[5839],{24058:(e,t,o)=>{"use strict";o.d(t,{Dl:()=>reverseGeocodeDawa,Yt:()=>getGeolocation,pK:()=>geocodeDawa,wF:()=>reverseGeocodeJIX});var r=o(65311),n=o.n(r),a=o(53495);function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach((function(t){_defineProperty(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function geocodeDawa(e){const t={q:e,struktur:"mini"};return(0,a.Z)(n().get("https://api.dataforsyningen.dk/adgangsadresser",t)).then((e=>{if(e.length)return{lng:e[0].x,lat:e[0].y,address:e[0].betegnelse,dawaAddressId:e[0].id};throw new Error("Failed to find address in DAWA")}))}function reverseGeocodeDawa(e){const t={x:e.lng,y:e.lat,struktur:"mini"};return(0,a.Z)(n().get("https://api.dataforsyningen.dk/adgangsadresser/reverse",t)).then((t=>_objectSpread(_objectSpread({},e),{},{address:t.betegnelse,dawaAddressId:t.id})))}function reverseGeocodeJIX(e){const t=`/api/address/v1/reverse-geocode/${e.lng}/${e.lat}`;return(0,a.Z)(n().get(t)).then((e=>({address:e.address,lng:e.location.x,lat:e.location.y})))}function getGeolocation(e){const t=window.sessionStorage.getItem("jix-user-pos");return t?Promise.resolve(JSON.parse(t)):function getCurrentPosition(){return new Promise(((e,t)=>{if(!("geolocation"in navigator))throw new Error(JIX.Gettext.__("Browseren understøtter ikke geografisk placering."));{const o={timeout:1e4,maximumAge:9e5,enableHighAccuracy:!1},success=t=>{const o={lat:t.coords.latitude,lng:t.coords.longitude};e(o)},error=e=>{let o;if(e.code)switch(e.code){case e.PERMISSION_DENIED:case e.TIMEOUT:o=JIX.Gettext.__('For at bruge "Nær placering" skal du godkende at vi må se din placering.');break;case e.POSITION_UNAVAILABLE:o=JIX.Gettext.__("Placering kunne ikke findes.")}t(new Error(o||e.message||JIX.Gettext.__("Ukendt fejl")))};navigator.geolocation.getCurrentPosition(success,error,o)}}))}().then(e).then((e=>(window.sessionStorage.setItem("jix-user-pos",JSON.stringify(e)),e)))}},42514:(e,t,o)=>{"use strict";o.d(t,{Z:()=>simpleAutocompleteConfig});var r=o(65311),n=o.n(r);function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach((function(t){_defineProperty(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const a={valueKey:"id",params:{},textFormat:"{{text}}",selectionFormat:null,customText:!1,queryKey:"query"};function format(e,t){return e.replace(/\{\{([a-zA-Z_][a-zA-Z0-9_]*)\}\}/g,((e,o)=>Object.prototype.hasOwnProperty.call(t,o)?n().trim(t[o]):""))}function handleResults(e,t){return{id:e[t.valueKey],text:format(t.textFormat,e),obj:e}}function simpleAutocompleteConfig(e,t={}){const o=_objectSpread(_objectSpread(_objectSpread({multiple:!!e&&e.multiple},a),e?n()(e).data():{}),t);let r;const l={minimumInputLength:void 0!==o.initselect?0:1,multiple:o.multiple,ajax:{url:o.url,dataType:"json",delay:250,cache:!0,data:e=>{const t=_objectSpread({},o.params);return t[o.queryKey]=e.term,r=e.term?e.term.trim().toLowerCase():"",t},processResults:e=>{if(0===r.length&&void 0!==o.initselect)return{results:o.initselect.map((e=>handleResults(e,o)))};let t;return t=o.transformResponse?o.transformResponse(e):e.result,{results:t.map((e=>handleResults(e,o)))}}}};return o.selectionFormat&&(l.templateSelection=e=>e.obj?format(o.selectionFormat,e.obj):e.text),o.customText&&(l.tags=!0,l.createTag=t=>{const o=t.term.trim();if(""!==o&&n()(e).select2("data").every((function(e){return 0!==e.text.toLowerCase().localeCompare(o.toLowerCase())})))return{id:o,text:o}}),l}},28844:(e,t,o)=>{"use strict";o.d(t,{Z:()=>s});var r=o(60611);var n=o(65311),a=o.n(n);const l={emits:["update:modelValue","select","unselect"],props:{select2Method:{type:String,default:"jix_select2"},config:{type:Object,default:()=>({})},modelValue:{type:[String,Number,Array],default:null}},data:()=>({ignoreChanges:!1}),mounted(){a()(this.$el)[this.select2Method](this.config).val(this.modelValue).trigger("change").on("change",(()=>{this.ignoreChanges||this.$emit("update:modelValue",a()(this.$el).val())})).on("select2:select",(e=>{this.ignoreChanges||this.$emit("select",e.params.data)})).on("select2:unselect",(()=>{this.ignoreChanges||this.$emit("unselect")}))},unmounted(){a()(this.$el).off().select2("destroy")},watch:{modelValue:{deep:!0,handler(){this.syncValue()}},config(e){a()(this.$el).empty()[this.select2Method](e)}},methods:{syncValue(){this.ignoreChanges=!0,a()(this.$el).val(this.modelValue).trigger("change"),this.ignoreChanges=!1},open(){a()(this.$el).select2("open")},close(){a()(this.$el).select2("close")},focus(){this.open(),this.close()}}};const s=(0,o(83744).Z)(l,[["render",function render(e,t,o,n,a,l){return(0,r.openBlock)(),(0,r.createElementBlock)("select",null,[(0,r.renderSlot)(e.$slots,"default")])}]])},5839:(e,t,o)=>{"use strict";o.d(t,{Z:()=>D});var r=o(60611),n=o(20779),a=o.n(n),l=o(98101),s=o(24058),i=o(36138);const{__:c,__x:u,__nx:d,__N:p}=JIX.Gettext,m={error:e=>u("Fejl: {message}",{message:e}),usePosition:()=>c("Brug min placering"),findingPosition:()=>c("Finder position…")};o(72262);const g={class:"dawa-autocomplete-container"},f={class:"input-group"},y=["value"],b={key:0,class:"input-group-append"},h=(0,r.createElementVNode)("span",{class:"spinner-grow spinner-grow-sm d-block",role:"status","aria-hidden":"true"},null,-1),v={class:"sr-only"},w=Object.assign({inheritAttrs:!1},{__name:"DsAddressFieldDawa",props:{modelValue:{type:String,default:""},disableGeolocation:{type:Boolean,default:!1},accessAddressOnly:{type:Boolean,default:!0},variant:{type:String,default:"light",validator:e=>["light","dark"].includes(e)}},emits:["update:modelValue","dawa-selected"],setup(e,{emit:t}){const o=e,n=(0,r.inject)("geolocationProvider",{getGeolocation:()=>(0,s.Yt)(s.Dl)}),c=(0,r.computed)((()=>({input:e=>{""===e.target.value&&o.modelValue&&t("update:modelValue","")},blur:e=>{e.target.value!==o.modelValue&&t("update:modelValue",e.target.value)}}))),u=(0,r.computed)((()=>"light"===o.variant?"btn-secondary":"btn-outline-light")),d=(0,r.ref)(),p=(0,r.ref)(null);(0,r.onMounted)((()=>{p.value=(0,l.U)(d.value,{adgangsadresserOnly:o.accessAddressOnly,select:e=>{t("update:modelValue",e.tekst);const o={zipcode:e.data.postnr,city:e.data.postnrnavn,roadName:e.data.vejnavn,houseNumber:e.data.husnr,floor:e.data.etage,door:e.data.dør,coordinates:{lng:e.data.x,lat:e.data.y}};t("dawa-selected",o)}})})),(0,r.onBeforeUnmount)((()=>{p.value&&(p.value.destroy(),p.value=null)}));const w=(0,r.ref)(!1);function lookupAddress(){w.value=!0,n.getGeolocation().then((e=>{t("update:modelValue",e.address)}),(e=>{console.error(e),a().alert(m.error(e.message))})).finally((()=>w.value=!1))}return(t,o)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",g,[(0,r.createElementVNode)("div",f,[(0,r.createElementVNode)("input",(0,r.mergeProps)(t.$attrs,(0,r.toHandlers)(c.value,!0),{ref_key:"inputEl",ref:d,type:"text",class:"form-control",value:e.modelValue}),null,16,y),e.disableGeolocation?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",b,[(0,r.createElementVNode)("button",{type:"button",class:(0,r.normalizeClass)(["btn",u.value,"address-input__geolocation"]),onClick:lookupAddress},[w.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[h,(0,r.createElementVNode)("span",v,(0,r.toDisplayString)((0,r.unref)(m).findingPosition()),1)],64)):((0,r.openBlock)(),(0,r.createBlock)(i.Z,{key:1,name:"geolocation","aria-label":(0,r.unref)(m).usePosition()},null,8,["aria-label"]))],2)]))])]))}});var O=o(28844),j=o(42514);const k={class:"w-100 overflow-hidden"},P={class:"input-group flex-nowrap"},_={class:"flex-grow-1 overflow-hidden"},V=["value"],S={key:0,class:"input-group-append"},x=(0,r.createElementVNode)("span",{class:"spinner-grow spinner-grow-sm d-block",role:"status","aria-hidden":"true"},null,-1),E={class:"sr-only"},B=Object.assign({inheritAttrs:!1},{__name:"DsAddressFieldJix",props:{modelValue:{type:String,default:""},disableGeolocation:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,n=(0,r.ref)([]);o.modelValue&&n.value.push(o.modelValue);const l=(0,r.ref)(o.modelValue);(0,r.watch)((()=>o.modelValue),(async e=>{n.value.includes(e)||n.value.push(e),await(0,r.nextTick)(),l.value=e}));const c=(0,j.Z)(null,{url:"/api/address/v1/autocomplete",transformResponse:e=>e.suggestions,queryKey:"address",valueKey:"full_address",textFormat:"{{full_address}}"}),u=(0,r.inject)("geolocationProvider",{getGeolocation:()=>(0,s.Yt)(s.wF)}),d=(0,r.ref)(!1);async function lookupAddress(){d.value=!0;try{const e=await u.getGeolocation();t("update:modelValue",e.address)}catch(e){console.error(e),a().alert(m.error(e.message))}finally{d.value=!1}}return(o,a)=>((0,r.openBlock)(),(0,r.createElementBlock)("div",k,[(0,r.createElementVNode)("div",P,[(0,r.createElementVNode)("div",_,[(0,r.createVNode)(O.Z,(0,r.mergeProps)(o.$attrs,{class:"form-control",config:(0,r.unref)(c),"model-value":l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t("update:modelValue",e))}),{default:(0,r.withCtx)((()=>[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(n.value,(e=>((0,r.openBlock)(),(0,r.createElementBlock)("option",{key:e,value:e},(0,r.toDisplayString)(e),9,V)))),128))])),_:1},16,["config","model-value"])]),e.disableGeolocation?(0,r.createCommentVNode)("",!0):((0,r.openBlock)(),(0,r.createElementBlock)("div",S,[(0,r.createElementVNode)("button",{type:"button",class:"btn btn-secondary address-input__geolocation",onClick:lookupAddress},[d.value?((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,{key:0},[x,(0,r.createElementVNode)("span",E,(0,r.toDisplayString)((0,r.unref)(m).findingPosition()),1)],64)):((0,r.openBlock)(),(0,r.createBlock)(i.Z,{key:1,name:"geolocation","aria-label":(0,r.unref)(m).usePosition()},null,8,["aria-label"]))])]))])]))}});function ownKeys(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(o),!0).forEach((function(t){_defineProperty(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}const D={emits:["update:modelValue","dawa-selected"],setup(e,{attrs:t,emit:o}){const n=/dk$/.test(window.Stash.common.site)?w:B;return()=>(0,r.h)(n,_objectSpread(_objectSpread({},t),{},{"onUpdate:modelValue":e=>o("update:modelValue",e),onDawaSelected:e=>o("dawa-selected",e)}))}}},72262:()=>{}}]);
//# sourceMappingURL=5839.a1ea678b40d424d5cd7c.bundle.js.map